(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{384:function(t,e,s){t.exports=s.p+"assets/img/deploytoazure.e0e5d477.png"},385:function(t,e,s){t.exports=s.p+"assets/img/UploadCSEtoContainer.a339b5d5.png"},386:function(t,e,s){t.exports=s.p+"assets/img/AddCSE-HelloWorldToVM2.0e40b952.png"},387:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAxwAAAAxCAYAAABQ3a99AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAy7SURBVHhe7ZtNr2XFdYb5R/wL+AkwiKLMiCxPoogfEJxkyBxseRLCmIEdxUjMUGIsHBiC7BkSkhWYMr3W09yXfnt17bNv33O2+348j1Q6u6rWWrXWqo996vTtV65EREREREQOwguHiIiIiIgchhcOERERERE5DC8cIiIiIiJyGF44RERERETkMLxwiIiIiIjIYexeOL7//79YLBaLxWKxWCwWy3PlJvgvHCIiIiIichheOERERERE5DC8cIiIiIiIyGF44RARERERkcPwwiEiIiIiIofhhUNERERERA7DC4eIiIiIiByGFw4RERERETkMLxwiIiIiInIYXjhEREREROQwvHCIiIiIiMhheOEQEREREZHDuNiF44cffrh66623rl555ZWfygcffHDde/fB10v4jh55IB+35dNPP33GF8o777xz3fvyuUSMDwHm5PXXX7/67rvvrlueJfPIJyCHfOp3id6/L7L251o9lY+Hgmfdj1ziHLjrZ91tYP2Tl719QP7u4llwNMxvz/fRZwbj7a2pr7766uq111578nkJLm3vIcFcv/nmm7fOzbn68vK4yIWDiX/11VefeXHxEnrvvffO/lLKQXHbF+JNmQcSPn/00UfXtWNZbR5eQrd5kZOnvYNVLge5fuONN5brk7nLl9L78KVirh3WI+vy1BcB5OeXBWK9y/HeJK5TeNbdnlXuH9pZh197X6KJmX7yTnlsX57mOuf5MfxQIT/CPJ+z5s/Vfyz8+c9/uvr1r3559fHv/vu65Sl/+Oyzq1+9/96Tzwny6KF/ac6+cDD5HBZHfck4+iWcL4Yv60vSavM8tJfwQ4Vcc+FYzRVzyLxSXtbaehHmPlt9OWyQvc0afdnsxXUKz7rzWOX+IZ112RNffPHF7hrLWnqMX7TnOmfu3377bb9APhJY7+yP2873ufqPhbf/+Z+u/uHv/+5J+b8//vG69cf8pZ3S5w9yaUf/0px94bjJC2P1opkvDJ7zT6zY+/777598po1fFbPAsMNBnb4+tPNS5ZejyGA77dMW0N++rGj/Ml5i57CknXrnI2N+/PHHP40dOcAHfEl79LZy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"},388:function(t,e,s){t.exports=s.p+"assets/img/AddCSE-HelloWorldToVM4Result.a9275f45.png"},389:function(t,e,s){t.exports=s.p+"assets/img/AddCSE-HelloWorldToVM5DownloadFolder.0ef95226.png"},390:function(t,e,s){t.exports=s.p+"assets/img/AddCSE-HelloWorldToVM6LogsFolder.6dda7ef1.png"},391:function(t,e,s){t.exports=s.p+"assets/img/saUploadCSE2.b3e7ae7c.png"},392:function(t,e,s){t.exports=s.p+"assets/img/ModifyARM.059cd7f7.png"},393:function(t,e,s){t.exports=s.p+"assets/img/CSE-Deployment.887c14a6.png"},394:function(t,e,s){t.exports=s.p+"assets/img/CSEIIS-Success.4d031f79.png"},772:function(t,e,s){"use strict";s.r(e);var a=s(42),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"optional-challenge-4-vm-custom-script-extensions-post-deployment-automation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optional-challenge-4-vm-custom-script-extensions-post-deployment-automation"}},[t._v("#")]),t._v(" [optional] Challenge 4: VM - Custom Script Extensions: Post deployment automation")]),t._v(" "),a("h2",{attrs:{id:"or-configure-setup-install-something-within-an-empty-vm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#or-configure-setup-install-something-within-an-empty-vm"}},[t._v("#")]),t._v(" or - configure / setup / install something within an empty vm")]),t._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[t._v("#")]),t._v(" Here is what you will learn")]),t._v(" "),a("ul",[a("li",[t._v("How to automate the further configuration / setup of an '"),a("em",[t._v("empty")]),t._v("' VM after it has been deployed.")]),t._v(" "),a("li",[t._v("Use a Custom Script Extension for a Windows VM.")]),t._v(" "),a("li",[t._v("Upload automation code into a storage account for anonymous download (so that the CSE agent can download)")]),t._v(" "),a("li",[t._v("Modify an ARM Template to enable '"),a("em",[t._v("0 touch VM deployments")]),t._v("'")])]),t._v(" "),a("h2",{attrs:{id:"do-you-need-a-vm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#do-you-need-a-vm"}},[t._v("#")]),t._v(" Do you need a VM?")]),t._v(" "),a("p",[a("strong",[t._v("For this lab you need an Azure virtual machine that runs Windows Server")]),t._v(". And some storage accessible to hold your automation code."),a("br"),t._v("\nJust "),a("strong",[t._v("click")]),t._v(" "),a("a",{attrs:{href:"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fazuredevcollege%2Ftrainingdays%2Fmaster%2Fday1%2Fchallenge-04%2Fchallengestart%2Fchallengestart.json"}},[a("img",{attrs:{src:s(384)}})]),t._v(" "),a("strong",[t._v("to spin up a new VM")]),t._v(" for this lab.")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Resource group")]),t._v(" "),a("td",[t._v("e.g. rg-www-test-001")])]),t._v(" "),a("tr",[a("td",[t._v("Location")]),t._v(" "),a("td",[t._v("e.g. North Europe")])]),t._v(" "),a("tr",[a("td",[t._v("Admin user")]),t._v(" "),a("td",[t._v("demoadmin")])]),t._v(" "),a("tr",[a("td",[t._v("Admin password")]),t._v(" "),a("td",[a("strong",[a("em",[t._v("some complex value")])])])]),t._v(" "),a("tr",[a("td",[t._v("Vm Size")]),t._v(" "),a("td",[t._v("e.g  Standard_F2s_v2")])]),t._v(" "),a("tr",[a("td",[t._v("Disk Sku")]),t._v(" "),a("td",[t._v("StandardSSD_LRS")])])])]),t._v(" "),a("h2",{attrs:{id:"attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attach-a-simple-helloworld-custom-script-extension-cse-to-a-vm-using-the-portal"}},[t._v("#")]),t._v(" Attach a simple HelloWorld Custom Script Extension (CSE) to a VM using the Portal")]),t._v(" "),a("ol",[a("li",[t._v("Take the following code and copy & paste it into a file named e.g. '"),a("em",[t._v("HelloWorld.ps1")]),t._v("':")])]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##############################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   HelloWorld Custom Script Extension (CSE)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##############################################")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c:\\temp\\CSEwasRunAt.txt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#create dir if it doesn't exist")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Test-Path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Split-Path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Split-Path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#write current time to file.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Date")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Out-File")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Append\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#This is really simple but imagine what else you can do to customize a vm ...")]),t._v("\n\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Upload this file to a storage account")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Group -> rg-www-test... -> sawww... (_your storage account_)  -> containers -> 'csescripts' -> Upload  \n->File \"HelloWorld.ps1\" -> Upload\n")])])]),a("p",[a("img",{attrs:{src:s(385),alt:"Upload CSE script to storage account"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Make this file being executed by the Custom Script Extension within the the VM:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Home -> Search 'virtual machines' -> 'vmblue' \n-> Extensions -> Add -> 'Custom Script Extension' -> Create\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Script file (Required)")]),t._v(" "),a("th",[t._v("Browse to your '"),a("em",[t._v("HelloWorld.ps1")]),t._v("' -> it is in your storage account 'sawww...' -> csescripts")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Arguments (Optional)")]),t._v(" "),a("td",[a("em",[t._v("none")])])])])]),t._v(" "),a("p",[a("strong",[t._v("Wait some seconds")]),t._v(" then do a "),a("strong",[t._v("refresh")]),t._v(" of your browser - it'll show the progress:"),a("br"),t._v(" "),a("img",{attrs:{src:s(386),alt:"Reload the page"}})]),t._v(" "),a("p",[t._v("Final result should show a success:"),a("br"),t._v(" "),a("img",{attrs:{src:s(387),alt:"Result"}})]),t._v(" "),a("h2",{attrs:{id:"see-what-has-happened-inside-the-vm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#see-what-has-happened-inside-the-vm"}},[t._v("#")]),t._v(" See what has happened inside the VM")]),t._v(" "),a("p",[t._v("Now we "),a("strong",[t._v("RDP into the VM")]),t._v(" and see what has happened "),a("strong",[t._v("and where to find logs")]),t._v(" in case something breaks.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Groups -> 'rg-www...' -> 'vmblue'\n  -> Connect -> Download RDP file -> Open -> Connect\n")])])]),a("p",[a("strong",[t._v("User")]),t._v(": demouser"),a("br"),t._v(" "),a("strong",[t._v("Password")]),t._v(": "),a("em",[t._v("%Your Password%")])]),t._v(" "),a("p",[t._v("Within the VM:")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("Navigate to c:\\temp")]),a("br"),t._v("\nThe "),a("strong",[t._v("result")]),t._v(" should look similar to this:"),a("br"),t._v(" "),a("img",{attrs:{src:s(388),alt:"CSE Result"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Navigate to C:\\Packages\\Plugins\\Microsoft.Compute.CustomScriptExtension\\ "),a("em",[t._v("%version%")]),t._v("\\Downloads")]),t._v("\nThe CSE is software that runs within the VM. The script that will be executed is "),a("strong",[t._v("download")]),t._v("ed first to this "),a("strong",[t._v("location")]),t._v(". If you don't see your script file CSE might have trouble to download the resource."),a("br"),t._v(" "),a("img",{attrs:{src:s(389),alt:"CSE Download Folder"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Navigate to C:\\WindowsAzure\\Logs\\Plugins\\Microsoft.Compute.CustomScriptExtension\\ "),a("em",[t._v("%version%")])]),t._v("\nThis is the place where the "),a("strong",[t._v("CSE logs its actions locally")]),t._v(" - a good place to start troubleshooting."),a("br"),t._v(" "),a("img",{attrs:{src:s(390),alt:"CSE Logs Folder"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Remove the CSE from the VM")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Home -> Search 'virtual machines' -> 'vmblue' -> 'Custom Script Extension' -> 'Uninstall'\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("Note: You can only have one Custom Script Extension attached to a vm at a time")]),t._v(". If you want to process multiple CSE scripts you need to: Install CSE ('Script1') -> deinstall CSE -> Install CSE ('Script2') -> deinstall ->...")])]),t._v(" "),a("h2",{attrs:{id:"optional-attaching-a-cse-to-a-vm-in-an-arm-template"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optional-attaching-a-cse-to-a-vm-in-an-arm-template"}},[t._v("#")]),t._v(" [optional] Attaching a CSE to a VM in an ARM Template")]),t._v(" "),a("p",[t._v("The goal of this action is to learn how to avoid the portal, i.e. so that the CSE can be attached to a VM during deployment time e.g. using an ARM template. With the whole setup Azure + VM Settings can be done in a '"),a("em",[t._v("0 touch way")]),t._v("'.")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("In the next CSE "),a("strong",[t._v("we want to install Internet Information Services (IIS) in the VM")]),t._v("."),a("br"),t._v('\nTake a look at the code file first ("'),a("a",{attrs:{href:"./CSE_Install-IIS.ps1"}},[t._v("CSE_Install-IIS.ps1")]),t._v('")'),a("br"),t._v("\nThe relevant parts starts at "),a("em",[t._v("#region install IIS features")])])]),t._v(" "),a("li",[a("p",[t._v("When automating CSE e.g. through "),a("strong",[t._v("ARM deployment")]),t._v(" - the CSE "),a("strong",[t._v("needs a valid download location for the code file")]),t._v(" (CSE_Install-IIS.ps1)."),a("br"),t._v("\nThis could be e.g. a public github repo or another https-reachable location."),a("br"),t._v("\nIn this lab "),a("strong",[t._v("we use a storage account for this")]),t._v("."),a("br"),t._v(" "),a("strong",[t._v('Upload ("'),a("a",{attrs:{href:"./CSE_Install-IIS.ps1"}},[t._v("CSE_Install-IIS.ps1")]),t._v('") file to a storage account.')])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Group -> rg-www -> sawww... (%your storage account%)  -> containers -> 'csescripts' -> Upload  \n->File \"CSE_Install-IIS.ps1\" -> Upload\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[t._v("Edit the CSE ARM template to use the correct scripts location")]),t._v("\nOnce uploaded you can copy the blobs URL from the azure portal"),a("br"),t._v(" "),a("img",{attrs:{src:s(391),alt:"Copy the URL of the IIS install script"}})])]),t._v(" "),a("p",[a("strong",[t._v("Can you download the file in your browser using the URL")]),t._v("? [Yes] If not have you set the correct access level at the container?")]),t._v(" "),a("p",[a("strong",[t._v("Edit this")]),t._v(" "),a("a",{attrs:{href:"./ARMCSE.json"}},[t._v("CSE ARM template")]),t._v(" "),a("strong",[t._v("template")]),t._v(" to use the scripts location:\n"),a("img",{attrs:{src:s(392),alt:"Edit following ARM section"}})]),t._v(" "),a("p",[a("strong",[t._v("with your value")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('...\n"fileUris": [\n    "https://sawww....blob.core.windows.net/cse/CSE_Install-IIS.ps1"\n],\n...\n')])])]),a("p",[a("strong",[t._v("Copy the template into the clipboard.")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Deploy the ARM Template.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Groups -> 'rg-www' -> '+' -> Template deployment -> \"Build your own template in the editor\" -> Paste the clipboard\n")])])]),a("p",[a("strong",[t._v("Select the right resource group and VM and deploy:")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Resource group")]),t._v(" "),a("td",[t._v("e.g. "),a("strong",[t._v("rg-www-test-001")])])]),t._v(" "),a("tr",[a("td",[t._v("Region")]),t._v(" "),a("td",[t._v("e.g. North Europe")])]),t._v(" "),a("tr",[a("td",[t._v("VM name")]),t._v(" "),a("td",[t._v("vmblue")])])])]),t._v(" "),a("p",[t._v("Deployment will take some minutes: A role is installed and an IIS feature is downloaded and installed."),a("br"),t._v("\nAt the end "),a("strong",[t._v("the result should look like this")]),a("br"),t._v(" "),a("img",{attrs:{src:s(393),alt:"CSE deployment"}}),a("br"),t._v("\nNow you have a web server in your VM - you should test by browsing to the public IP address:"),a("br"),t._v(" "),a("img",{attrs:{src:s(394),alt:"Running IIS"}})]),t._v(" "),a("h2",{attrs:{id:"cleanup-the-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cleanup-the-environment"}},[t._v("#")]),t._v(" Cleanup the environment")]),t._v(" "),a("p",[t._v("Cleanup by deleting the resource group.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Groups -> 'rg-www' -> 'Delete resource group'\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);