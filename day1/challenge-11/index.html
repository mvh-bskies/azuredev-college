<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 11: Networking: Distribute traffic accross global Azure regions for optimal latency and availability using Traffic Manager | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.bc728db4.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.d38bf813.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.5ff1d4d5.js" as="script"><link rel="preload" href="/trainingdays/assets/js/19.a350c78d.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.e0433817.js"><link rel="prefetch" href="/trainingdays/assets/js/11.cd8c7b17.js"><link rel="prefetch" href="/trainingdays/assets/js/12.12888c30.js"><link rel="prefetch" href="/trainingdays/assets/js/13.873bda65.js"><link rel="prefetch" href="/trainingdays/assets/js/14.1a24ee27.js"><link rel="prefetch" href="/trainingdays/assets/js/15.6fa51cf9.js"><link rel="prefetch" href="/trainingdays/assets/js/16.d5e02596.js"><link rel="prefetch" href="/trainingdays/assets/js/17.fcaa5f26.js"><link rel="prefetch" href="/trainingdays/assets/js/18.f2a21d28.js"><link rel="prefetch" href="/trainingdays/assets/js/20.bfd694b1.js"><link rel="prefetch" href="/trainingdays/assets/js/21.bed10b37.js"><link rel="prefetch" href="/trainingdays/assets/js/22.860246de.js"><link rel="prefetch" href="/trainingdays/assets/js/23.b225110a.js"><link rel="prefetch" href="/trainingdays/assets/js/24.13b22772.js"><link rel="prefetch" href="/trainingdays/assets/js/25.e0f5a7a3.js"><link rel="prefetch" href="/trainingdays/assets/js/26.c1146b2a.js"><link rel="prefetch" href="/trainingdays/assets/js/27.ab26807b.js"><link rel="prefetch" href="/trainingdays/assets/js/28.ab2698cc.js"><link rel="prefetch" href="/trainingdays/assets/js/29.496ec42d.js"><link rel="prefetch" href="/trainingdays/assets/js/3.b5657a11.js"><link rel="prefetch" href="/trainingdays/assets/js/30.fd15c623.js"><link rel="prefetch" href="/trainingdays/assets/js/31.72ed4ad1.js"><link rel="prefetch" href="/trainingdays/assets/js/32.81e15b13.js"><link rel="prefetch" href="/trainingdays/assets/js/33.f1fcf176.js"><link rel="prefetch" href="/trainingdays/assets/js/34.8432e852.js"><link rel="prefetch" href="/trainingdays/assets/js/35.61413aac.js"><link rel="prefetch" href="/trainingdays/assets/js/36.dc009a95.js"><link rel="prefetch" href="/trainingdays/assets/js/37.88c251fb.js"><link rel="prefetch" href="/trainingdays/assets/js/38.b9f64ed2.js"><link rel="prefetch" href="/trainingdays/assets/js/39.4bf7d432.js"><link rel="prefetch" href="/trainingdays/assets/js/4.316442a1.js"><link rel="prefetch" href="/trainingdays/assets/js/40.a1779f5a.js"><link rel="prefetch" href="/trainingdays/assets/js/41.b4f159db.js"><link rel="prefetch" href="/trainingdays/assets/js/42.096f1aa1.js"><link rel="prefetch" href="/trainingdays/assets/js/43.cf13395f.js"><link rel="prefetch" href="/trainingdays/assets/js/44.92be7e22.js"><link rel="prefetch" href="/trainingdays/assets/js/45.298ad7f7.js"><link rel="prefetch" href="/trainingdays/assets/js/46.4d6179b3.js"><link rel="prefetch" href="/trainingdays/assets/js/47.bc41cef1.js"><link rel="prefetch" href="/trainingdays/assets/js/48.31275a9a.js"><link rel="prefetch" href="/trainingdays/assets/js/49.a2dc55f9.js"><link rel="prefetch" href="/trainingdays/assets/js/5.815c1276.js"><link rel="prefetch" href="/trainingdays/assets/js/50.c6016f95.js"><link rel="prefetch" href="/trainingdays/assets/js/51.0bd2785b.js"><link rel="prefetch" href="/trainingdays/assets/js/52.4e12987f.js"><link rel="prefetch" href="/trainingdays/assets/js/53.fb7850b1.js"><link rel="prefetch" href="/trainingdays/assets/js/54.1f20c333.js"><link rel="prefetch" href="/trainingdays/assets/js/55.d1950d56.js"><link rel="prefetch" href="/trainingdays/assets/js/56.3a6b8119.js"><link rel="prefetch" href="/trainingdays/assets/js/57.3639003b.js"><link rel="prefetch" href="/trainingdays/assets/js/58.091b6b2a.js"><link rel="prefetch" href="/trainingdays/assets/js/59.b1b6f798.js"><link rel="prefetch" href="/trainingdays/assets/js/6.6bc81206.js"><link rel="prefetch" href="/trainingdays/assets/js/60.8312cc43.js"><link rel="prefetch" href="/trainingdays/assets/js/61.8077d507.js"><link rel="prefetch" href="/trainingdays/assets/js/62.7099a9ec.js"><link rel="prefetch" href="/trainingdays/assets/js/63.de9324f4.js"><link rel="prefetch" href="/trainingdays/assets/js/64.69b552bd.js"><link rel="prefetch" href="/trainingdays/assets/js/65.7999d6d6.js"><link rel="prefetch" href="/trainingdays/assets/js/66.bd4052c9.js"><link rel="prefetch" href="/trainingdays/assets/js/67.e79e194c.js"><link rel="prefetch" href="/trainingdays/assets/js/68.f8d8015a.js"><link rel="prefetch" href="/trainingdays/assets/js/69.e5994ee8.js"><link rel="prefetch" href="/trainingdays/assets/js/7.60b45c24.js"><link rel="prefetch" href="/trainingdays/assets/js/70.55b1b75a.js"><link rel="prefetch" href="/trainingdays/assets/js/71.eba7950f.js"><link rel="prefetch" href="/trainingdays/assets/js/72.75c0fa4d.js"><link rel="prefetch" href="/trainingdays/assets/js/73.457d78aa.js"><link rel="prefetch" href="/trainingdays/assets/js/74.a278da89.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8f7da85a.js"><link rel="prefetch" href="/trainingdays/assets/js/76.306b2367.js"><link rel="prefetch" href="/trainingdays/assets/js/77.4b93f5b5.js"><link rel="prefetch" href="/trainingdays/assets/js/78.149c6cba.js"><link rel="prefetch" href="/trainingdays/assets/js/79.df492d10.js"><link rel="prefetch" href="/trainingdays/assets/js/8.240e2339.js"><link rel="prefetch" href="/trainingdays/assets/js/80.91573785.js"><link rel="prefetch" href="/trainingdays/assets/js/9.6caa67cc.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.bc728db4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" aria-current="page" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-11-networking-distribute-traffic-accross-global-azure-regions-for-optimal-latency-and-availability-using-traffic-manager"><a href="#challenge-11-networking-distribute-traffic-accross-global-azure-regions-for-optimal-latency-and-availability-using-traffic-manager" class="header-anchor">#</a> Challenge 11: Networking: Distribute traffic accross global Azure regions for optimal latency and availability using Traffic Manager</h1> <p><strong><a href="https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview" target="_blank" rel="noopener noreferrer">Traffic Manager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> uses DNS to load balance traffic to endpoints accross Azure regions. It can help you to:</p> <ul><li><strong>provide optimal latency</strong> by serving clients from the <strong>nearest location</strong>.</li> <li><strong>increase availability</strong> as it monitors its endpoints and <strong>provides failover</strong>.</li> <li><strong>redirect traffic</strong> to online endpoints while others are in <strong>maintenance</strong>.</li> <li>...</li></ul> <h2 id="here-is-what-you-will-learn"><a href="#here-is-what-you-will-learn" class="header-anchor">#</a> Here is what you will learn</h2> <ul><li>How to setup Traffic Manager using the Azure portal.</li> <li>Setup 2 endpoints located in 2 Azure regions ('North Europe', 'West Europe')</li> <li>Configure loadbalancing based on clients origin geography.</li></ul> <p>Our <strong>final architecture</strong> will look like this:
<img src="/trainingdays/assets/img/TMArchitecture.ca56d9d4.png" alt="Final architecture"></p> <blockquote><p>To speed things up you will execute a script that creates the VMs and Load balancers in the 2 regions automatically. Then you will setup the Traffic Manager using the portal.</p></blockquote> <h2 id="_1-deploy-the-starting-point"><a href="#_1-deploy-the-starting-point" class="header-anchor">#</a> 1. Deploy the 'starting point'</h2> <p>Now let's <strong>create some vms</strong> using the 'Cloud Shell' in the Azure Portal.</p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; Click the 'Cloud Shell' symbol close to your login details on the right upper corner.
</code></pre></div><p><img src="data:image/png;base64,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" alt="Cloud Shell">)<br>
The <strong>'Cloud Shell' is an in-browser-accessible shell for managing Azure resources</strong>. It already has the required SDKs and tools installed to interact with Azure. You can use either Bash or PowerShell.<br>
When being asked <strong>choose PowerShell this time</strong>.<br> <strong>The first time you use the 'Cloud Shell' you will be asked to setup a storage account</strong> e.g. to store files you have uploaded persistently. <a href="https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage" target="_blank" rel="noopener noreferrer">See<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; Click 'Show advanced settings'
</code></pre></div><p><img src="/trainingdays/assets/img/CloudShell1.af6f63c1.png" alt="Cloud Shell Storage Account Setup"></p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td>Subscription</td> <td><em>your subscription</em></td></tr> <tr><td>Cloud Shell Region</td> <td><strong>North Europe</strong></td></tr> <tr><td>Resource Group</td> <td><strong>rg-cloudshell</strong></td></tr> <tr><td>Storage Account</td> <td><strong><em>some unique value</em></strong></td></tr> <tr><td>File Share</td> <td><strong>cloudshell</strong></td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>[Azure Portal] -&gt; Create storage
</code></pre></div><p>Once successful your shell should appear at the bottom of the page:<br> <img src="/trainingdays/assets/img/CloudShell2.3a511722.png" alt="Cloud Shell in the Azure portal"></p> <p>To setup the starting point <strong>copy &amp; paste the following code into the Cloud Shell</strong>:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#Creates some resource groups in different azure regions</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>Location <span class="token string">'North Europe'</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>Location <span class="token string">'West Europe'</span>
<span class="token function">New-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb'</span> <span class="token operator">-</span>Location <span class="token string">'North Europe'</span>

<span class="token variable">$TemplateParameters</span> = @<span class="token punctuation">{</span>
    <span class="token string">&quot;adminUser&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'demouser'</span><span class="token punctuation">;</span>
    <span class="token string">&quot;adminPassword&quot;</span> = <span class="token namespace">[System.Security.SecureString]</span><span class="token punctuation">(</span><span class="token function">Read-Host</span> <span class="token operator">-</span>Prompt <span class="token string">&quot;adminUser password please&quot;</span> <span class="token operator">-</span>AsSecureString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token string">&quot;vmNames&quot;</span> = <span class="token namespace">[array]</span>@<span class="token punctuation">(</span><span class="token string">'vmblue'</span><span class="token punctuation">,</span><span class="token string">'vmred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token string">&quot;vmSize&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'Standard_F2s_v2'</span> <span class="token comment"># or 'Standard_B2s'</span>
    <span class="token string">&quot;DiskSku&quot;</span> = <span class="token namespace">[string]</span><span class="token string">'StandardSSD_LRS'</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Enter the password as asked.</strong>  Then execute the deployment by adding 2 lines</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token comment">#will create some vms in different azure regions in parallel</span>
<span class="token function">New-AzResourceGroupDeployment</span> <span class="token operator">-</span>Name <span class="token string">'NE'</span> <span class="token operator">-</span>TemplateUri <span class="token string">&quot;https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-11/challengestart/challengestart.json&quot;</span> <span class="token operator">-</span>ResourceGroupName <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>TemplateParameterObject <span class="token variable">$TemplateParameters</span> <span class="token operator">-</span>AsJob

<span class="token variable">$TemplateParameters</span><span class="token punctuation">.</span>vmNames = @<span class="token punctuation">(</span><span class="token string">'vmyellow'</span><span class="token punctuation">,</span><span class="token string">'vmgreen'</span><span class="token punctuation">)</span>
<span class="token function">New-AzResourceGroupDeployment</span> <span class="token operator">-</span>Name <span class="token string">'WE'</span> <span class="token operator">-</span>TemplateUri <span class="token string">&quot;https://raw.githubusercontent.com/azuredevcollege/trainingdays/master/day1/challenge-11/challengestart/challengestart.json&quot;</span> <span class="token operator">-</span>ResourceGroupName <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>TemplateParameterObject <span class="token variable">$TemplateParameters</span> <span class="token operator">-</span>AsJob  

<span class="token comment">#wait until both deployments are done</span>
<span class="token function">get-job</span> <span class="token operator">-</span>State Running <span class="token punctuation">|</span> <span class="token function">wait-job</span>  

</code></pre></div><h2 id="_2-deploy-a-traffic-manager-instance"><a href="#_2-deploy-a-traffic-manager-instance" class="header-anchor">#</a> 2. Deploy a Traffic Manager instance</h2> <p><a href="https://docs.microsoft.com/en-us/azure/traffic-manager/quickstart-create-traffic-manager-profile#add-traffic-manager-endpoints" target="_blank" rel="noopener noreferrer">Add Traffic Manager Profile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in resource group <strong>rg-wwwlb</strong> with a routing method based on e.g. <strong>performance</strong></p> <p>Add 2 endpoints to the traffic manager.</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td>Type</td> <td><strong>Azure endpoint</strong></td></tr> <tr><td>Name</td> <td><strong>Dublin</strong></td></tr> <tr><td>Target resource type</td> <td><strong>Public IP address</strong></td></tr> <tr><td>Public IP address</td> <td><strong>pip-wwwlb-NE</strong></td></tr></tbody></table> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td>Type</td> <td><strong>Azure endpoint</strong></td></tr> <tr><td>Name</td> <td><strong>Amsterdam</strong></td></tr> <tr><td>Target resource type</td> <td><strong>Public IP address</strong></td></tr> <tr><td>Public IP address</td> <td><strong>pip-wwwlb-WE</strong></td></tr></tbody></table> <p>Now test by opening the traffic managers DNS name in your browser (you might need to open multiple different browsers to see some change):</p> <table><thead><tr><th><img src="/trainingdays/assets/img/testvmyellow.aea3026f.png" alt="VM Yellow"></th> <th><img src="/trainingdays/assets/img/testvmgreen.12c7f72b.png" alt="VM Green"></th> <th><img src="/trainingdays/assets/img/testvmblue.c0cd4c61.png" alt="VM Blue"></th> <th><img src="/trainingdays/assets/img/testvmred.e245166e.png" alt="VM Red"></th></tr></thead> <tbody><tr><td>vmyellow (Amsterdam)</td> <td>vmgreen (Amsterdam)</td> <td>vmblue (Dublin)</td> <td>vmred (Dublin)</td></tr></tbody></table> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p><strong>Delete the resource groups <em>rg-wwwlb....</em></strong> or execute this in the Cloud Shell:</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-NE'</span> <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob
<span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb-WE'</span> <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob
<span class="token function">Remove-AzResourceGroup</span> <span class="token operator">-</span>Name <span class="token string">'rg-wwwlb'</span>    <span class="token operator">-</span>Force <span class="token operator">-</span>AsJob

<span class="token function">Get-Job</span> <span class="token operator">-</span>State Running <span class="token punctuation">|</span> <span class="token function">Wait-Job</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day1/challenge-11/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.d38bf813.js" defer></script><script src="/trainingdays/assets/js/2.5ff1d4d5.js" defer></script><script src="/trainingdays/assets/js/19.a350c78d.js" defer></script>
  </body>
</html>
