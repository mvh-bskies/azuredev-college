<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Serverless | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.bc728db4.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.d38bf813.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.5ff1d4d5.js" as="script"><link rel="preload" href="/trainingdays/assets/js/13.873bda65.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.e0433817.js"><link rel="prefetch" href="/trainingdays/assets/js/11.cd8c7b17.js"><link rel="prefetch" href="/trainingdays/assets/js/12.12888c30.js"><link rel="prefetch" href="/trainingdays/assets/js/14.1a24ee27.js"><link rel="prefetch" href="/trainingdays/assets/js/15.6fa51cf9.js"><link rel="prefetch" href="/trainingdays/assets/js/16.d5e02596.js"><link rel="prefetch" href="/trainingdays/assets/js/17.fcaa5f26.js"><link rel="prefetch" href="/trainingdays/assets/js/18.f2a21d28.js"><link rel="prefetch" href="/trainingdays/assets/js/19.a350c78d.js"><link rel="prefetch" href="/trainingdays/assets/js/20.bfd694b1.js"><link rel="prefetch" href="/trainingdays/assets/js/21.bed10b37.js"><link rel="prefetch" href="/trainingdays/assets/js/22.860246de.js"><link rel="prefetch" href="/trainingdays/assets/js/23.b225110a.js"><link rel="prefetch" href="/trainingdays/assets/js/24.13b22772.js"><link rel="prefetch" href="/trainingdays/assets/js/25.e0f5a7a3.js"><link rel="prefetch" href="/trainingdays/assets/js/26.c1146b2a.js"><link rel="prefetch" href="/trainingdays/assets/js/27.ab26807b.js"><link rel="prefetch" href="/trainingdays/assets/js/28.ab2698cc.js"><link rel="prefetch" href="/trainingdays/assets/js/29.496ec42d.js"><link rel="prefetch" href="/trainingdays/assets/js/3.b5657a11.js"><link rel="prefetch" href="/trainingdays/assets/js/30.fd15c623.js"><link rel="prefetch" href="/trainingdays/assets/js/31.72ed4ad1.js"><link rel="prefetch" href="/trainingdays/assets/js/32.81e15b13.js"><link rel="prefetch" href="/trainingdays/assets/js/33.f1fcf176.js"><link rel="prefetch" href="/trainingdays/assets/js/34.8432e852.js"><link rel="prefetch" href="/trainingdays/assets/js/35.61413aac.js"><link rel="prefetch" href="/trainingdays/assets/js/36.dc009a95.js"><link rel="prefetch" href="/trainingdays/assets/js/37.88c251fb.js"><link rel="prefetch" href="/trainingdays/assets/js/38.b9f64ed2.js"><link rel="prefetch" href="/trainingdays/assets/js/39.4bf7d432.js"><link rel="prefetch" href="/trainingdays/assets/js/4.316442a1.js"><link rel="prefetch" href="/trainingdays/assets/js/40.a1779f5a.js"><link rel="prefetch" href="/trainingdays/assets/js/41.b4f159db.js"><link rel="prefetch" href="/trainingdays/assets/js/42.096f1aa1.js"><link rel="prefetch" href="/trainingdays/assets/js/43.cf13395f.js"><link rel="prefetch" href="/trainingdays/assets/js/44.92be7e22.js"><link rel="prefetch" href="/trainingdays/assets/js/45.298ad7f7.js"><link rel="prefetch" href="/trainingdays/assets/js/46.4d6179b3.js"><link rel="prefetch" href="/trainingdays/assets/js/47.bc41cef1.js"><link rel="prefetch" href="/trainingdays/assets/js/48.31275a9a.js"><link rel="prefetch" href="/trainingdays/assets/js/49.a2dc55f9.js"><link rel="prefetch" href="/trainingdays/assets/js/5.815c1276.js"><link rel="prefetch" href="/trainingdays/assets/js/50.c6016f95.js"><link rel="prefetch" href="/trainingdays/assets/js/51.0bd2785b.js"><link rel="prefetch" href="/trainingdays/assets/js/52.4e12987f.js"><link rel="prefetch" href="/trainingdays/assets/js/53.fb7850b1.js"><link rel="prefetch" href="/trainingdays/assets/js/54.1f20c333.js"><link rel="prefetch" href="/trainingdays/assets/js/55.d1950d56.js"><link rel="prefetch" href="/trainingdays/assets/js/56.3a6b8119.js"><link rel="prefetch" href="/trainingdays/assets/js/57.3639003b.js"><link rel="prefetch" href="/trainingdays/assets/js/58.091b6b2a.js"><link rel="prefetch" href="/trainingdays/assets/js/59.b1b6f798.js"><link rel="prefetch" href="/trainingdays/assets/js/6.6bc81206.js"><link rel="prefetch" href="/trainingdays/assets/js/60.8312cc43.js"><link rel="prefetch" href="/trainingdays/assets/js/61.8077d507.js"><link rel="prefetch" href="/trainingdays/assets/js/62.7099a9ec.js"><link rel="prefetch" href="/trainingdays/assets/js/63.de9324f4.js"><link rel="prefetch" href="/trainingdays/assets/js/64.69b552bd.js"><link rel="prefetch" href="/trainingdays/assets/js/65.7999d6d6.js"><link rel="prefetch" href="/trainingdays/assets/js/66.bd4052c9.js"><link rel="prefetch" href="/trainingdays/assets/js/67.e79e194c.js"><link rel="prefetch" href="/trainingdays/assets/js/68.f8d8015a.js"><link rel="prefetch" href="/trainingdays/assets/js/69.e5994ee8.js"><link rel="prefetch" href="/trainingdays/assets/js/7.60b45c24.js"><link rel="prefetch" href="/trainingdays/assets/js/70.55b1b75a.js"><link rel="prefetch" href="/trainingdays/assets/js/71.eba7950f.js"><link rel="prefetch" href="/trainingdays/assets/js/72.75c0fa4d.js"><link rel="prefetch" href="/trainingdays/assets/js/73.457d78aa.js"><link rel="prefetch" href="/trainingdays/assets/js/74.a278da89.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8f7da85a.js"><link rel="prefetch" href="/trainingdays/assets/js/76.306b2367.js"><link rel="prefetch" href="/trainingdays/assets/js/77.4b93f5b5.js"><link rel="prefetch" href="/trainingdays/assets/js/78.149c6cba.js"><link rel="prefetch" href="/trainingdays/assets/js/79.df492d10.js"><link rel="prefetch" href="/trainingdays/assets/js/8.240e2339.js"><link rel="prefetch" href="/trainingdays/assets/js/80.91573785.js"><link rel="prefetch" href="/trainingdays/assets/js/9.6caa67cc.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.bc728db4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" aria-current="page" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="serverless"><a href="#serverless" class="header-anchor">#</a> Serverless</h1> <h2 id="here-is-what-you-will-learn"><a href="#here-is-what-you-will-learn" class="header-anchor">#</a> Here is what you will learn</h2> <ul><li>Create an Azure Function on your local machine</li> <li>Learn how to debug Azure Functions</li> <li>Learn how to use Function Triggers to react to events in Azure</li> <li>Deploy Azure Functions</li></ul> <h2 id="create-a-local-azure-function"><a href="#create-a-local-azure-function" class="header-anchor">#</a> Create a local Azure Function</h2> <p>To get familiar with Azure Functions on your local machine, we will be creating a sample that listens for files on an Azure Storage Account (Blob). Each time a new file will be added to a predefined container, our function will be called by Azure, giving us the opportunity to manipulate the file and save it to another location (just a small sample).</p> <p>So, first of all, we need to create a Storage Account to being able to upload/process files.</p> <h3 id="add-a-storage-account"><a href="#add-a-storage-account" class="header-anchor">#</a> Add a Storage Account</h3> <p>Go to the Azure Portal and click on <strong>&quot;Create a resource&quot;</strong>, in the next view choose/search for <strong>&quot;Storage Account&quot;</strong> and afterwards click <em>create</em>.</p> <p>Follow the wizard:</p> <ul><li>put the Storage Account in a new resource group called <em>serverless-rg</em></li> <li>give your account a global unique name</li> <li>For Location, choose &quot;West Europe&quot;</li> <li>Performance Tier: Standard</li> <li>Account Kind: Storage V2 (General Purpose)</li> <li>Replication: Locally-redundant storage (LRS)</li> <li>Access Tier: Hot</li></ul> <p>Leave all other options to their defaults. In the summary view, it should look like that:</p> <p><img src="/trainingdays/assets/img/portal_storageaccount.42e7a95b.png" alt="create" title="create"></p> <p>Proceed and create the Storage Account.</p> <p>When the deployment has finished, go to the storage account and open &quot;Containers&quot; (under &quot;Blob service&quot;) and create a container called <strong>originals</strong> and another one called <strong>processed</strong> (leave the proposed settings for <strong>Public Access Level</strong> - <em>Private</em>).</p> <p>The infrastructure to store files is now ready. Let's create the local Azure Function.</p> <h3 id="create-the-local-function-app"><a href="#create-the-local-function-app" class="header-anchor">#</a> Create the local Function App</h3> <p>Open a new Visual Studio Code window and switch to the Azure Tools Exentsion. In the section for &quot;Functions&quot;, click on &quot;Create New Project&quot; and select a new, empty folder on your local machine:</p> <p><img src="/trainingdays/assets/img/function_create.f2a257fb.png" alt="func_create" title="func_create"></p> <p>The Wizard will guide you through the local setup process.</p> <p>Choose the following options:</p> <ul><li>Language: C#
<img src="/trainingdays/assets/img/functions_wizard1.80854a36.png" alt="functions_wizard1" title="functions_wizard1"></li> <li>Template: BlobTrigger
<img src="/trainingdays/assets/img/functions_wizard2.8957d094.png" alt="functions_wizard2" title="functions_wizard2"></li> <li>Function Name: BlobTriggerCSharp
<img src="/trainingdays/assets/img/functions_wizard3.21fd1514.png" alt="functions_wizard3" title="functions_wizard3"></li> <li>Namespace: AzDevCollege.Function
<img src="/trainingdays/assets/img/functions_wizard4.0a1935a1.png" alt="functions_wizard4" title="functions_wizard4"></li> <li>Settings: Create new local app setting
<img src="/trainingdays/assets/img/functions_wizard5.d7f6fc92.png" alt="functions_wizard5" title="functions_wizard5"></li> <li>Storage Account: select the storage account you created previously
<img src="/trainingdays/assets/img/functions_wizard6.cc694b88.png" alt="functions_wizard6" title="functions_wizard6"></li> <li>Trigger Path (the container name we want to listen to for new files): originals
<img src="/trainingdays/assets/img/functions_wizard7.25ae7287.png" alt="functions_wizard7" title="functions_wizard7"></li> <li>Debug: select the same storage account as above</li></ul> <p>When everything is setup in VS Code, let's test the function.</p> <p>Open <em>BlobTriggerCSharp.cs</em> file and set a breakpoint in the &quot;<em>Run</em>&quot; method.</p> <p>Start the Azure Function by hitting <strong>F5</strong>.</p> <blockquote><p><strong>Info</strong>: If you get a message that the core function tools are required, install them by executing <code>npm i -g azure-functions-core-tools@3 --unsafe-perm true</code>. If you still see an error, it's likely that remote-signed Powerhell scripts aren't allowed on your machine. To fix that, run <code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned</code> in a Powershell environment (as admin!).</p></blockquote> <p>The debug console should print logs like that:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token operator">&gt;</span> Executing task: func <span class="token function">host</span> start <span class="token operator">&lt;</span>


                  %%%%%%
                 %%%%%%
            @   %%%%%%    @
          @@   %%%%%%      @@
       @@@    %%%%%%%%%%%    @@@
     @@      %%%%%%%%%%        @@
       @@         %%%%       @@
         @@      %%%       @@
           @@    %%      @@
                %%
                %

Azure Functions Core Tools <span class="token punctuation">(</span><span class="token number">2.7</span>.1948 Commit hash: 29a0626ded3ae99c4111f66763f27bb9fb564103<span class="token punctuation">)</span>
Function Runtime Version: <span class="token number">2.0</span>.12888.0
</code></pre></div><p>Now, open the Azure Storage Explorer, find your storage account and select the <em>originals</em> container (alternatively: go to the Portal and open the &quot;Storage Explorer&quot; in the Storage Account).</p> <p><img src="/trainingdays/assets/img/storage_explorer_view.52ed3f13.png" alt="storage_explorer_view" title="storage_explorer_view"></p> <p>Drag'n Drop a file to the container or upload one via the menu. After a few seconds, the breakpoint in VS Code will be hit. Examine the properties of the <strong>myBlob</strong> variable.</p> <h3 id="adjusting-the-sample"><a href="#adjusting-the-sample" class="header-anchor">#</a> Adjusting the Sample</h3> <p>So, great, we can now receive events when a file is added to blob storage. Let's add a more meaningful sample. We want to receive images that we will be resizing/manipulating in our function and write the result to the <strong>processed</strong> container.</p> <p>Therefore, we need to add a dependency to our project that enables us to do image manipulation in dotnet core. We will use <strong>SixLabors.ImageSharp</strong> <a href="https://github.com/SixLabors/ImageSharp" target="_blank" rel="noopener noreferrer">https://github.com/SixLabors/ImageSharp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Open a terminal and go to your projects folder. Add the library:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dotnet <span class="token function">add</span> <span class="token operator">&lt;</span>NAME_OF_FUNCTION_PROJECT<span class="token operator">&gt;</span>.csproj package SixLabors.ImageSharp
</code></pre></div><p>Now, back in Visual Studio Code, replace the contents of the file <strong>BlobTriggerCSharp.cs</strong> with:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Host</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">SixLabors<span class="token punctuation">.</span>ImageSharp</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">SixLabors<span class="token punctuation">.</span>ImageSharp<span class="token punctuation">.</span>Processing</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">AzDevCollege<span class="token punctuation">.</span>Function</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BlobTriggerCSharp</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FunctionName</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;BlobTriggerCSharp&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">BlobTrigger</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;originals/{name}&quot;</span><span class="token punctuation">,</span> Connection <span class="token operator">=</span> <span class="token string">&quot;&lt;REPLACE_WITH_NAME_OF_STORAGE_ACCOUNT&gt;_STORAGE&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token class-name">Stream</span> myBlob<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Blob</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;processed/proc_{name}&quot;</span><span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">,</span> Connection <span class="token operator">=</span> <span class="token string">&quot;&lt;REPLACE_WITH_NAME_OF_STORAGE_ACCOUNT&gt;_STORAGE&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">Stream</span> outStream<span class="token punctuation">,</span> <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Image</span> image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Resize and rotate the image!</span>
                image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Rotate</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                image<span class="token punctuation">.</span><span class="token function">SaveAsJpeg</span><span class="token punctuation">(</span>outStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;C# Blob trigger function Processed blob\n Name:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">name</span><span class="token punctuation">}</span></span><span class="token string"> \n Size: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">myBlob<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string"> Bytes&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>What has been added to the <strong>Run</strong> method:</p> <ul><li><strong>[Blob(&quot;processed/proc_{name}&quot;, FileAccess.Write)] Stream outStream</strong> parameter to automatically write the results of the image manipulation to a blob in the container <em>processed</em> having the same file name, prefixed with &quot;proc&quot;. This is called an <strong>Output Binding</strong>. You simply write data to these kind of annotated variables and Azure takes care of storing to the configured &quot;data store&quot;. For more information on that, see <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob?tabs=csharp#output" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob?tabs=csharp#output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Code to manipulate the input image in the <em>using</em> statement</li></ul> <p>Now restart the local Azure Function and when the function is ready to accept calls, again go to the Storage Explorer and drag an <strong>image</strong> (! - please use an image!) to the folder <strong>orginals</strong>. A few seconds later, you will see that the Azure Function has been triggered.</p> <p>Now check the <em>processed</em> container. You will find a new <strong>proc_</strong> image with the results of our manipulation.</p> <p>If everything works as expected on your local machine, let's deploy to Azure.</p> <h2 id="deploy-an-azure-function-app-to-azure"><a href="#deploy-an-azure-function-app-to-azure" class="header-anchor">#</a> Deploy an Azure Function App to Azure</h2> <p>Go to the Azure Tools Extension and click on the &quot;Deploy to Azure...&quot; button in the &quot;Functions&quot; section. A wizard will guide you through the creation process (- you are now already familiar with that).</p> <blockquote><p><strong>Important</strong>: choose <strong>Advanced</strong> mode.</p></blockquote> <p><img src="/trainingdays/assets/img/functions_deploy_wizard1.ba3125ef.png" alt="functions_deploy_wizard1" title="functions_deploy_wizard1"></p> <p>Choose the following options, when asked:</p> <ul><li>Runtime: .NET Core 3.1</li> <li>OS: Windows</li> <li>Hosting Plan: Consumption</li> <li>resource groupe: <strong>serverless-rg</strong></li> <li>when asked, select the same storage account used in the local sample</li> <li>You can skip the creation of an Application Insights instance (--&gt; &quot;Skip for now&quot;)</li></ul> <p>We still have to configure our Functions App, to be able to listen to blob changes in the Storage Account (BlobTrigger information). Therefore, got to the Portal and open the Functions App you previously created.
Open the Application settings under <strong>Configuration</strong> and add a new application setting (<strong>you can check your <em>local.settings.json</em> file for the correct values!</strong>):</p> <table><thead><tr><th>Name</th> <th>Value</th></tr></thead> <tbody><tr><td>&lt;storageaccountname&gt;_STORAGE</td> <td>enter the connection string to the storage account (you can copy that from your <em>local.settings.json</em> file)</td></tr></tbody></table> <hr> <br> <p><strong>Make sure to click on <em>Save</em> afterwards.</strong></p> <p>Afterwards, it should like that:</p> <p><img src="/trainingdays/assets/img/azure_function_settings.805a54cf.png" alt="azure_function_settings" title="azure_function_settings"></p> <p>Now, test again (upload images) and check, if the Function App is running correctly in Azure (<em>it might be necessary to restart your function app</em>).</p> <h2 id="house-keeping"><a href="#house-keeping" class="header-anchor">#</a> House Keeping</h2> <p>Remove the sample resource group.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ az group delete -n serverless-rg
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day2/challenges/challenge-2.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.d38bf813.js" defer></script><script src="/trainingdays/assets/js/2.5ff1d4d5.js" defer></script><script src="/trainingdays/assets/js/13.873bda65.js" defer></script>
  </body>
</html>
